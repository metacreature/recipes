$.fn.tinymce=function(r){return this.each(function(){function t(e){return 83!=e.which||!e.ctrlKey||($(e.target).hasClass("mce-content-body")&&a.click(),e.preventDefault(),!1)}var e=$.extend(!0,{},$.fn.tinymce.defaults,r),n=$(this).closest("form"),a=e.submit_btn?$(e.submit_btn):n.find(".btn-ajax-submit").first();$(this).addClass("is_tinymce");tinymce.init({target:$(this)[0],menubar:!1,height:e.height,plugins:"link image code fullscreen",toolbar:"code fullscreen | undo redo | removeformat | bold italic underline | alignleft aligncenter, alignright, alignjustify | bullist numlist link image",link_class_list:[{title:"External Textlink",value:"text_link external_link"},{title:"External Button",value:"button_link external_link"},{title:"External",value:"external_link"},{title:"Internal Textlink",value:"text_link internal_link"},{title:"Internal Button",value:"button_link internal_link"},{title:"Internal",value:"internal_link"}],target_list:[{text:"New window",value:"_blank"},{text:"Current window",value:""}],default_link_target:"_blank",link_title:!1,convert_urls:!1,content_css:"/static/css/bundle.min.css,"+ADMIN_WEB_ROOT+"/static/css/tinymce_content.css"}).then(function(e){$("iframe").contents().keydown(t),$("iframe").contents().keypress(t)})})},$.fn.tinymce.defaults={submit_btn:null,height:300},$.fn.ajax_form=function(r){return this.each(function(){var e,t=$.extend(!0,{},$.fn.ajax_form.defaults,r),n=$(this),a=t.submit_btn?$(t.submit_btn):n.find(".btn-ajax-submit").first(),t=(n.on("submit",function(e){$.fn.ajax_form.submit_form(n,a,r),e.preventDefault(),e.stopPropagation()}),a.click(function(e){e.preventDefault(),e.stopPropagation(),n.submit()}),$.fn.ajax_form.init_press_save(n,a),sessionStorage.getItem("form_messages"));t&&void 0!==(t=JSON.parse(t))[e=n.data("name")+"__"+document.location.href]&&n.find(".ajax-form-response").html('<span class="ajax-form-success">'+t[e]+"</span>").show()})},$.fn.ajax_form.init_press_save=function(n,a){function e(e){var t;if(!$("body").hasClass("blockkeyactions"))return 83!=e.which||!e.ctrlKey||((t=$(e.target)).hasClass("form-control")&&t.closest("form")[0]==n[0]&&a.click(),e.preventDefault(),!1)}document.addEventListener("keydown",e),document.addEventListener("keypress",e)},$.fn.ajax_form.ajax_form_complete=function(t,n,a,e,r){function s(){var e=t.find(".ajax-form-response").offset().top;$(document).scrollTop(e-30)}var i,a=$.extend(!0,{},$.fn.ajax_form.defaults,a);t.find(".ajax-form-response").hide().html(""),t.find(".field-error-msg").remove(),t.find(".line-error").removeClass("line-error"),t.find(".field-error").removeClass("field-error");if("object"!=typeof e||is_empty(e)){a.error&&a.error(t,n,null);let e="Es ist ein Fehler aufgetreten! Bitte versuche es sp√§ter noch einmal!";a.default_error&&(e=a.default_error),t.find(".field-error").remove(),t.find(".field-line").removeClass("line-error"),t.find(".ajax-form-response").html('<span class="ajax-form-error">'+e+"</span>").show(),n.removeClass("btn-loading")}else if(e.success&&e.redirect_url)e.message&&((i={})[t.data("name")+"__"+e.redirect_url]=e.message,sessionStorage.setItem("form_messages",JSON.stringify(i))),document.location.replace(e.redirect_url);else if(e.success)a.success&&a.success(t,n,e),e.message&&(t.find(".ajax-form-response").html('<span class="ajax-form-success">'+e.message+"</span>").show(),s()),t.find(".ajax-form-success-hide").hide();else if(e.warning)a.warning&&a.warning(t,n,e),e.message&&(t.find(".ajax-form-response").html('<span class="ajax-form-warning">'+e.message+"</span>").show(),s()),t.find(".ajax-form-warning-hide").hide();else{a.error&&a.error(t,n,e);var l,o,f,m=e.field_errors||e.errors;if(!is_empty(m)){for(l in m)(o=(o=t.find('[name="'+l+'"]').first()).attr("name")?o:t.find('[name="'+l+'[]"]').first()).addClass("field-error").closest(".field-line").addClass("line-error"),!0!==m[l]&&(f="string"==typeof m[l]?m[l]:m[l][0],o.closest(".field-line").prepend('<span class="field-error-msg">'+f+"</span>"));(o=t.find(".line-error [name]")).first().focus()}e.message&&(t.find(".ajax-form-response").html('<span class="ajax-form-error">'+e.message+"</span>").show(),o&&0!=o.length||s())}n.removeClass("btn-loading"),t.data("is_submitting",!1)},$.fn.ajax_form.fullSerializeFormArray=function(e,t){var n=/\r?\n/g,a=/^(?:submit|button|image|reset)$/i,r=/^(?:input|select|textarea|keygen)/i,s=/^(?:checkbox|radio)$/i,l=e.map(function(){var e=$.prop(this,"elements");return e?$.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&(!$(this).is(":disabled")||t)&&r.test(this.nodeName)&&!a.test(e)&&(this.checked||!s.test(e))}).get(),o=new FormData;for(i in l){var f=$(l[i]),m=f.attr("name");"file"==f.attr("type")&&f[0].files?o.append(m,f[0].files[0]):null==(f=f.hasClass("is_tinymce")?tinymce.get(f.attr("id")).getContent():f.val())?o.append(m,null):Array.isArray(f)?$.map(f,function(e){o.append(m,e.replace(n,"\r\n"))}):o.append(m,f.replace(n,"\r\n"))}return o},$.fn.ajax_form.submit_form=function(t,n,a){var e;t.data("is_submitting")||(t.data("is_submitting",!0),(e=$.extend(!0,{},$.fn.ajax_form.defaults,a)).beforesubmit&&e.beforesubmit(t,n),e=$.fn.ajax_form.fullSerializeFormArray(t),n.addClass("btn-loading"),n.blur(),$.ajax({type:"POST",dataType:"json",url:n.data("endpoint")?n.data("endpoint"):document.location_href,data:e,contentType:!1,processData:!1,complete:function(e){$.fn.ajax_form.ajax_form_complete(t,n,a,e.responseJSON,e.status)}}))},$.fn.ajax_form.defaults={default_error:null,submit_btn:null,beforesubmit:null,success:null,warning:null,error:null},$(function(){sessionStorage.removeItem("form_messages")});