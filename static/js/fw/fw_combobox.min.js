$.fn.combobox=function(s,o){return"update_list"===s?this.each(function(){$(this).data("loaded",!1).data("data_list",Array.from(o))}):this.each(function(){var t=$.extend(!0,{},$.fn.combobox.defaults,s),a=$(this),i=($.fn.combobox.instance+=1,$('<div class="combobox_dd" id="combobox_dd_'+$.fn.combobox.instance+'"></div>')),o=(a.wrap('<div class="combobox_wrapper" id="combobox_wrapper_'+$.fn.combobox.instance+'"></div>'),a.after(i),t.list&&a.data("data_list",Array.from(t.list)),a.data("combobox_instance",$.fn.combobox.instance),a.addClass("combobox"),$('<span class="glyphicons glyphicons-menu-hamburger combobox_button"></span>')),e=(a.after(o),!1);a.focus_timer=null,a.focus(function(o){$.fn.combobox.load_list(a,i,t,!0),focus_timer=setTimeout(function(){e=!0},40)}),a.blur(function(o){focus_timer&&(window.clearTimeout(a.focus_timer),a.focus_timer=null),e=!1,i.hide()}),a.mousedown(function(){e&&(i.is(":visible")?i.hide():$.fn.combobox.load_list(a,i,t,!0))}),a.keyup(function(){$.fn.combobox.load_list(a,i,t,!0),e=!0})})},$.fn.combobox.load_list=function(e,s,o,n){if(e.data("loaded"))$.fn.combobox.hideshow_options(e,s,n);else if(e.data("loaded",!0),e.data("data_list")){var t,a,i=e.data("data_list");for(t in s.html(""),i)a=$("<div>"+html_special_chars(i[t])+"</div>").data("val",i[t]),s.append(a),"string"==typeof i[t]&&(i[t]=i[t].toLowerCase());e.data("data_list",i),s.find("div").mousedown(function(o){e.focus_timer&&(window.clearTimeout(e.focus_timer),e.focus_timer=null),e.val($(this).data("val")),is_focused=!1,s.hide()}),$.fn.combobox.hideshow_options(e,s,n)}else $.ajax({type:"POST",dataType:"json",url:o.url,data:{table:o.table,col:o.col,id:o.id,field:e.attr("name")},complete:function(o){if(o.responseJSON&&void 0!==o.responseJSON.data){var t,a,i=o.responseJSON.data;for(t in i)a=$("<div>"+html_special_chars(i[t].entry)+"</div>").data("val",i[t].entry),s.append(a),"string"==typeof i[t].entry?i[t]=i[t].entry.toLowerCase():i[t]=i[t].entry;e.data("data_list",i),s.find("div").mousedown(function(o){e.focus_timer&&(window.clearTimeout(e.focus_timer),e.focus_timer=null),e.val($(this).data("val")),is_focused=!1,s.hide()}),$.fn.combobox.hideshow_options(e,s,n)}else e.data("loaded",!1)}})},$.fn.combobox.hideshow_options=function(o,t,a){var i=o.data("data_list"),e=o.val().toLowerCase();is_empty(o.val())?t.find("div").show():t.find("div").each(function(){$(this).data("val").toLowerCase().includes(e)?$(this).show():$(this).hide()}),is_empty(o.val())||-1===i.indexOf(e)?(t.find("div").removeClass("active"),a&&t.show(),t.scrollTop(0)):-1<i.indexOf(e)&&t.find("div").removeClass("active").each(function(){if($(this).data("val").toLowerCase()==e)return $(this).show().addClass("active"),a&&t.show(),t.scrollTop($(this).position().top),!1})},$.fn.combobox.update=$.fn.combobox.instance=0,$.fn.combobox.defaults={url:null,table:null,col:null,id:null,list:null};