$.fn.combobox=function(e,o){return"update_list"===e?this.each(function(){$(this).data("loaded",!1).data("data_list",Array.from(o))}):this.each(function(){var a=$.extend(!0,{},$.fn.combobox.defaults,e),s=$(this);$.fn.combobox.instance+=1;var t=$('<div class="combobox_dd" id="combobox_dd_'+$.fn.combobox.instance+'"></div>');s.wrap('<div class="combobox_wrapper" id="combobox_wrapper_'+$.fn.combobox.instance+'"></div>'),s.after(t),a.list&&s.data("data_list",Array.from(a.list)),s.data("combobox_instance",$.fn.combobox.instance),s.addClass("combobox");var o=$('<span class="glyphicons glyphicons-menu-hamburger combobox_button"></span>');s.after(o);var i=!1;s.focus_timer=null,s.focus(function(o){$.fn.combobox.load_list(s,t,a,!0),focus_timer=setTimeout(function(){i=!0},40)}),s.blur(function(o){focus_timer&&(window.clearTimeout(s.focus_timer),s.focus_timer=null),i=!1,t.hide()}),s.mousedown(function(){i&&(t.is(":visible")?t.hide():$.fn.combobox.load_list(s,t,a,!0))}),s.keyup(function(){$.fn.combobox.load_list(s,t,a,!0),i=!0}),s.change(function(){var o=s.data("data_list"),a=s.val();is_empty(s.val())?s.removeClass("combobox_ok").removeClass("combobox_warning"):o.includes(a)?s.addClass("combobox_ok").removeClass("combobox_warning"):s.removeClass("combobox_ok").addClass("combobox_warning")})})},$.fn.combobox.load_list=function(i,e,o,n){if(i.data("loaded"))$.fn.combobox.hideshow_options(i,e,n);else{if(i.data("loaded",!0),i.data("data_list")){var a,s,t=Array.from(i.data("data_list"));for(a in e.html(""),t)s=$("<div>"+html_special_chars(t[a])+"</div>").data("val",t[a]),e.append(s),"string"==typeof t[a]&&(t[a]=t[a].toLowerCase());return i.data("data_list_lower",t),e.find("div").mousedown(function(o){i.focus_timer&&(window.clearTimeout(i.focus_timer),i.focus_timer=null),i.addClass("combobox_ok").removeClass("combobox_warning"),i.val($(this).data("val")),is_focused=!1,e.hide()}),void $.fn.combobox.hideshow_options(i,e,n)}$.ajax({type:"POST",dataType:"json",url:o.url,data:{table:o.table,col:o.col,id:o.id,field:i.attr("name")},complete:function(o){if(o.responseJSON&&void 0!==o.responseJSON.data){i.data("data_list",o.responseJSON.data);var a,s,t=Array.from(o.responseJSON.data);for(a in t)s=$("<div>"+html_special_chars(t[a].entry)+"</div>").data("val",t[a].entry),e.append(s),"string"==typeof t[a].entry?t[a]=t[a].entry.toLowerCase():t[a]=t[a].entry;i.data("data_list_lower",t),e.find("div").mousedown(function(o){i.focus_timer&&(window.clearTimeout(i.focus_timer),i.focus_timer=null),i.addClass("combobox_ok").removeClass("combobox_warning"),i.val($(this).data("val")),is_focused=!1,e.hide()}),$.fn.combobox.hideshow_options(i,e,n)}else i.data("loaded",!1)}})}},$.fn.combobox.hideshow_options=function(o,a,s){var t=o.data("data_list"),i=o.data("data_list_lower"),e=o.val(),n=o.val().toLowerCase();if(is_empty(o.val())?a.find("div").show():a.find("div").each(function(){$(this).data("val").toLowerCase().includes(n)?$(this).show():$(this).hide()}),is_empty(o.val())?o.removeClass("combobox_ok").removeClass("combobox_warning"):t.includes(e)?o.addClass("combobox_ok").removeClass("combobox_warning"):o.removeClass("combobox_ok").addClass("combobox_warning"),is_empty(o.val())||-1===i.indexOf(n))return a.find("div").removeClass("active"),s&&a.show(),void a.scrollTop(0);-1<i.indexOf(n)&&a.find("div").removeClass("active").each(function(){if($(this).data("val").toLowerCase()==n)return $(this).show().addClass("active"),s&&a.show(),a.scrollTop($(this).position().top),!1})},$.fn.combobox.update=$.fn.combobox.instance=0,$.fn.combobox.defaults={url:null,table:null,col:null,id:null,list:null};